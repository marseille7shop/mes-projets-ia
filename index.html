<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Projets IA - Tableau de Bord</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles personnalisés pour le drag and drop */
        .dragging { opacity: 0.5; }
        .drag-over { background-color: rgba(59, 130, 246, 0.1); }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="app" class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <div class="flex justify-between items-start">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">Mes Projets IA</h1>
                        <p class="text-gray-400">Tableau de bord pour suivre l'avancement de vos projets</p>
                    </div>
                    <div class="text-right">
                        <button onclick="exportData()" class="text-sm text-gray-400 hover:text-white mb-2">
                            Exporter les données
                        </button>
                        <p class="text-xs text-gray-500" id="lastSaved">
                            Sauvegarde auto : --:--:--
                        </p>
                    </div>
                </div>
            </div>

            <!-- Colonnes Kanban -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="kanban-board">
                <!-- Les colonnes seront générées par JavaScript -->
            </div>
        </div>

        <!-- Modal Nouveau Projet -->
        <div id="addProjectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="bg-gray-800 rounded-lg p-6 w-full max-w-md">
                <h3 class="text-xl font-semibold mb-4">Nouveau projet</h3>
                <div class="space-y-4">
                    <input type="text" id="newProjectTitle" placeholder="Nom du projet" 
                           class="w-full p-2 bg-gray-700 rounded text-white">
                    <textarea id="newProjectDescription" placeholder="Description" 
                              class="w-full p-2 bg-gray-700 rounded text-white h-24"></textarea>
                    <select id="newProjectPriority" class="w-full p-2 bg-gray-700 rounded text-white">
                        <option value="haute">Priorité haute</option>
                        <option value="moyenne" selected>Priorité moyenne</option>
                        <option value="basse">Priorité basse</option>
                    </select>
                    <div class="flex gap-2">
                        <button onclick="addProject()" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded transition-colors">
                            Ajouter
                        </button>
                        <button onclick="closeAddModal()" 
                                class="flex-1 bg-gray-700 hover:bg-gray-600 py-2 rounded transition-colors">
                            Annuler
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // État global
        let projects = [];
        let draggedProject = null;

        // Configuration des colonnes
        const columns = [
            { id: 'idees', title: 'Idées', color: 'bg-blue-500' },
            { id: 'en-cours', title: 'En cours', color: 'bg-yellow-500' },
            { id: 'en-pause', title: 'En pause', color: 'bg-gray-500' },
            { id: 'termine', title: 'Terminé', color: 'bg-green-500' }
        ];

        const priorityColors = {
            haute: 'border-red-500',
            moyenne: 'border-yellow-500',
            basse: 'border-green-500'
        };

        // Charger les projets depuis localStorage
        function loadProjects() {
            const saved = localStorage.getItem('ia-projects');
            if (saved) {
                projects = JSON.parse(saved);
            } else {
                // Projets par défaut
                projects = [
                    { id: 1, title: 'Gridbot', description: 'Bot de trading automatisé', status: 'en-cours', priority: 'haute', notes: '' },
                    { id: 2, title: 'Création site internet', description: 'Portfolio personnel avec projets IA', status: 'en-cours', priority: 'moyenne', notes: '' },
                    { id: 3, title: 'Projet revenus passifs', description: 'Automatisation et monétisation', status: 'idees', priority: 'moyenne', notes: '' }
                ];
            }
        }

        // Sauvegarder les projets
        function saveProjects() {
            localStorage.setItem('ia-projects', JSON.stringify(projects));
            document.getElementById('lastSaved').textContent = `Sauvegarde auto : ${new Date().toLocaleTimeString()}`;
        }

        // Rendre le tableau Kanban
        function renderBoard() {
            const board = document.getElementById('kanban-board');
            board.innerHTML = columns.map(column => `
                <div class="bg-gray-800 rounded-lg p-4" 
                     ondrop="drop(event, '${column.id}')" 
                     ondragover="allowDrop(event)"
                     ondragleave="dragLeave(event)">
                    <div class="flex items-center mb-4">
                        <div class="w-3 h-3 rounded-full ${column.color} mr-2"></div>
                        <h2 class="text-lg font-semibold">${column.title}</h2>
                        <span class="ml-auto text-sm text-gray-500">
                            ${projects.filter(p => p.status === column.id).length}
                        </span>
                    </div>
                    <div class="space-y-3" id="column-${column.id}">
                        ${renderProjectCards(column.id)}
                    </div>
                    ${column.id === 'idees' ? `
                        <button onclick="openAddModal()" 
                                class="mt-3 w-full py-2 border border-dashed border-gray-600 rounded-lg 
                                       hover:border-gray-500 hover:bg-gray-700 transition-all flex items-center 
                                       justify-center text-gray-400 hover:text-white">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M12 4v16m8-8H4"></path>
                            </svg>
                            Nouveau projet
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }

        // Rendre les cartes de projet
        function renderProjectCards(status) {
            return projects
                .filter(p => p.status === status)
                .map(project => `
                    <div id="project-${project.id}" 
                         class="bg-gray-700 p-3 rounded-lg cursor-move border-l-4 ${priorityColors[project.priority]} 
                                hover:bg-gray-600 transition-colors"
                         draggable="true" 
                         ondragstart="drag(event, ${project.id})">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">${project.title}</h3>
                            <div class="flex gap-1">
                                <button onclick="editProject(${project.id})" 
                                        class="text-gray-400 hover:text-white">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button onclick="deleteProject(${project.id})" 
                                        class="text-gray-400 hover:text-red-400">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <p class="text-sm text-gray-400 mb-2">${project.description}</p>
                        
                        <div class="mb-2">
                            <button onclick="toggleNotes(${project.id})" 
                                    class="flex items-center text-xs text-gray-500 hover:text-gray-300">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Notes & détails
                            </button>
                            <div id="notes-${project.id}" class="hidden mt-2">
                                <textarea class="w-full bg-gray-600 p-2 rounded text-xs" 
                                          placeholder="Ajoutez des notes, idées, liens, todo..." 
                                          rows="4"
                                          onclick="event.stopPropagation()"
                                          onblur="updateNotes(${project.id}, this.value)">${project.notes || ''}</textarea>
                            </div>
                        </div>
                        
                        <div class="flex items-center text-xs text-gray-500">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                      d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                            </svg>
                            <span>Priorité ${project.priority}</span>
                        </div>
                    </div>
                `).join('');
        }

        // Drag and Drop
        function drag(event, projectId) {
            draggedProject = projects.find(p => p.id === projectId);
            event.dataTransfer.effectAllowed = 'move';
            event.target.classList.add('dragging');
        }

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function dragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function drop(event, status) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            if (draggedProject) {
                draggedProject.status = status;
                saveProjects();
                renderBoard();
            }
        }

        // Gestion des projets
        function openAddModal() {
            document.getElementById('addProjectModal').classList.remove('hidden');
            document.getElementById('newProjectTitle').focus();
        }

        function closeAddModal() {
            document.getElementById('addProjectModal').classList.add('hidden');
            document.getElementById('newProjectTitle').value = '';
            document.getElementById('newProjectDescription').value = '';
            document.getElementById('newProjectPriority').value = 'moyenne';
        }

        function addProject() {
            const title = document.getElementById('newProjectTitle').value;
            const description = document.getElementById('newProjectDescription').value;
            const priority = document.getElementById('newProjectPriority').value;
            
            if (title) {
                const newProject = {
                    id: Date.now(),
                    title,
                    description,
                    priority,
                    status: 'idees',
                    notes: '',
                    createdAt: new Date().toISOString()
                };
                projects.push(newProject);
                saveProjects();
                renderBoard();
                closeAddModal();
            }
        }

        function deleteProject(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce projet ?')) {
                projects = projects.filter(p => p.id !== id);
                saveProjects();
                renderBoard();
            }
        }

        function editProject(id) {
            const project = projects.find(p => p.id === id);
            const newTitle = prompt('Titre du projet:', project.title);
            if (newTitle !== null) {
                project.title = newTitle;
                const newDescription = prompt('Description:', project.description);
                if (newDescription !== null) {
                    project.description = newDescription;
                    saveProjects();
                    renderBoard();
                }
            }
        }

        function toggleNotes(id) {
            const notesDiv = document.getElementById(`notes-${id}`);
            notesDiv.classList.toggle('hidden');
        }

        function updateNotes(id, value) {
            const project = projects.find(p => p.id === id);
            project.notes = value;
            saveProjects();
        }

        // Export des données
        function exportData() {
            const dataStr = JSON.stringify(projects, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `projets-ia-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Initialisation
        loadProjects();
        renderBoard();
        saveProjects();
    </script>
</body>
</html>